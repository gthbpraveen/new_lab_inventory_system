
# @app.route("/register", methods=["GET", "POST"])
# def register():
#     if request.method == "POST":
#         email = request.form["email"]
#         password = request.form["password"]
#         confirm_password = request.form["confirm_password"]

#         # Validation
#         if not email.endswith("@cse.iith.ac.in"):
#             flash("Only @cse.iith.ac.in emails are allowed.", "danger")
#             return redirect("/register")

#         if len(password) < 6:
#             flash("Password must be at least 6 characters long.", "danger")
#             return redirect("/register")

#         if password != confirm_password:
#             flash("Passwords do not match.", "danger")
#             return redirect("/register")

#         # Check for duplicate
#         existing_user = User.query.filter_by(email=email).first()
#         if existing_user:
#             flash("⚠️ Email already registered. Please login.", "warning")
#             return redirect("/login")

#         is_admin = email.lower() == "admin@cse.iith.ac.in"

#         new_user = User(
#             email=email,
#             password=generate_password_hash(password),
#             is_approved=is_admin,
#             approved_at=datetime.utcnow() if is_admin else None,
#             registered_at=datetime.utcnow()
#         )
#         db.session.add(new_user)
#         db.session.commit()

#         flash("✅ Registered!" + (" You're auto-approved as Admin." if is_admin else " Please wait for admin approval."))
#         return redirect("/login")

#     return render_template("register.html")

# @app.route("/register", methods=["GET", "POST"])
# def register():
#     if request.method == "POST":
#         email = request.form["email"].strip().lower()
#         password = request.form["password"]
#         confirm_password = request.form["confirm_password"]
#         role = request.form.get("role")  # new field

#         # Validation: only IITH emails
#         if not (email.endswith("@cse.iith.ac.in") or email.endswith("@iith.ac.in")):
#             flash("Only @cse.iith.ac.in or @iith.ac.in emails are allowed.", "danger")
#             return redirect("/register")

#         if not role:
#             flash("Please select a role.", "danger")
#             return redirect("/register")

#         if len(password) < 6:
#             flash("Password must be at least 6 characters long.", "danger")
#             return redirect("/register")

#         if password != confirm_password:
#             flash("Passwords do not match.", "danger")
#             return redirect("/register")

#         # Check for duplicate
#         existing_user = User.query.filter_by(email=email).first()
#         if existing_user:
#             flash("⚠️ Email already registered. Please login.", "warning")
#             return redirect("/login")

#         # Role logic
#         is_admin = (role == "admin" and email == "admin@cse.iith.ac.in")

#         new_user = User(
#             email=email,
#             password=generate_password_hash(password),
#             role=role,
#             is_approved=is_admin,  # only Admin auto-approved
#             approved_at=datetime.utcnow() if is_admin else None,
#             registered_at=datetime.utcnow()
#         )
#         db.session.add(new_user)
#         db.session.commit()

#         flash("✅ Registered as {}!".format(role.capitalize()) +
#               (" You're auto-approved as Admin." if is_admin else " Please wait for admin approval."),
#               "success")
#         return redirect("/login")

#     return render_template("register.html")