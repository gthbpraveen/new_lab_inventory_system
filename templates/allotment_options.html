{% extends "login_home.html" %}
{% block title %}Allotment Hub{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto p-6">

  <!-- Search Box -->
  <!-- <form method="POST" class="flex gap-3 mb-6">
    <input type="text" name="roll" placeholder="Enter Roll Number"
           value="{{ roll or '' }}" required
           class="flex-1 border rounded-lg px-4 py-2 focus:ring focus:ring-indigo-300"/>
    <button type="submit"
            class="bg-indigo-600 text-white px-6 py-2 rounded-lg shadow hover:bg-indigo-700">
      Search
    </button>
  </form> -->

 
  {% if student %}
<!-- Student Header -->
<div class="bg-white shadow-xl rounded-2xl p-8 mb-8 border border-gray-200">
  <div class="flex flex-col md:flex-row items-center justify-between gap-8">
    
    <!-- Left: Student Details -->
    <div class="md:w-1/2 w-full text-left">
      <h2 class="text-3xl font-extrabold text-indigo-800 tracking-wide">{{ student.name }}</h2>
      <p class="mt-2 text-lg text-gray-700">
        üéì Roll: <span class="font-semibold text-gray-900">{{ student.roll }}</span><br>
        üìò <span class="text-indigo-600 font-medium">{{ student.course }}</span>  
        <span class="text-gray-500">(Year {{ student.year }})</span>
      </p>
    </div>

    <!-- Right: Room & Cubicle Details -->
    <div class="md:w-1/3 w-full">
      {% if current_cubicle %}
      <div class="bg-gradient-to-br from-indigo-600 to-indigo-800 text-white rounded-xl p-6 shadow-lg text-center">
        <p class="text-sm uppercase tracking-wide text-indigo-200">Current Allocation</p>
        <p class="mt-2 text-2xl font-extrabold">
          Cubicle {{ current_cubicle.number }}
        </p>
        <p class="mt-1 text-2xl font-medium text-indigo-100">
          Room: {{ current_cubicle.room_lab.name }}
        </p>
      </div>
      {% else %}
      <div class="bg-gray-100 rounded-xl p-6 shadow-inner text-center">
        <p class="text-gray-500 italic">‚ùå No cubicle assigned</p>
      </div>
      {% endif %}
    </div>

  </div>
</div>







     <!-- <div class="bg-white rounded-xl shadow p-6 text-center">
        <h3 class="text-xl font-bold text-indigo-800 mb-4">‚ö° Quick Allotment Options</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <a href="{{ url_for('space_allocation', roll=roll) }}"
             class="block bg-blue-600 text-white p-6 rounded-lg shadow hover:bg-blue-700 text-center transform hover:scale-105 transition">
            <div class="text-4xl mb-2">ü™ë</div>
            <h4 class="font-semibold text-lg">Allocate / Reassign Cubicle</h4>
          </a>
          
          <a href="{{ url_for('assignments_list', roll=roll) }}"
             class="block bg-green-600 text-white p-6 rounded-lg shadow hover:bg-purple-700 text-center transform hover:scale-105 transition">
            <div class="text-4xl mb-2">üë•</div>
            <h4 class="font-semibold text-lg">Workstation Assignments</h4>
          </a>

          <a href="{{ url_for('assignments_list', roll=roll) }}"
             class="block bg-purple-600 text-white p-6 rounded-lg shadow hover:bg-purple-700 text-center transform hover:scale-105 transition">
            <div class="text-4xl mb-2">üë•</div>
            <h4 class="font-semibold text-lg">IT Equipment Assignments</h4>
          </a>
        </div>
      </div> -->
<div class="bg-white rounded-xl shadow p-6 text-center">
  <h3 class="text-xl font-bold text-indigo-800 mb-4">‚ö° Quick Allotment Options</h3>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <!-- Cubicle -->
    <a href="{{ url_for('space_allocation', roll=roll) }}"
       class="block bg-blue-600 text-white p-6 rounded-lg shadow hover:bg-blue-700 text-center transform hover:scale-105 transition">
      <div class="flex justify-center mb-2">
        <!-- Chair Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18h12M9 14h6v4H9v-4zm0-10h6v6H9V4z"/>
        </svg>
      </div>
      <h4 class="font-semibold text-lg">Allocate / Reassign Cubicle</h4>
    </a>

    <!-- Workstation -->
    <a href="{{ url_for('assignments_list', roll=roll) }}"
       class="block bg-green-600 text-white p-6 rounded-lg shadow hover:bg-green-700 text-center transform hover:scale-105 transition">
      <div class="flex justify-center mb-2">
        <!-- Computer Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
        </svg>
      </div>
      <h4 class="font-semibold text-lg">Workstation Assignments</h4>
    </a>

    <!-- IT Equipment -->
    <a href="{{ url_for('assignments_list', roll=roll) }}"
       class="block bg-purple-600 text-white p-6 rounded-lg shadow hover:bg-purple-700 text-center transform hover:scale-105 transition">
      <div class="flex justify-center mb-2">
        <!-- Devices Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17h6m-3-3v6m-6-6h12M5 4h14v6H5z"/>
        </svg>
      </div>
      <h4 class="font-semibold text-lg">IT Equipment Assignments</h4>
    </a>

  </div>
</div>

  <!-- Tabs -->
  <div class="border-b border-gray-200 mb-6">
    <nav class="-mb-px flex space-x-6" id="tabs">
      <button data-tab="profile" class="tab-link border-indigo-600 text-indigo-600 px-3 py-2 font-medium border-b-2">Profile</button>
      <button data-tab="space" class="tab-link text-gray-500 hover:text-indigo-600 px-3 py-2 font-medium border-b-2 border-transparent">Space</button>
      <button data-tab="workstations" class="tab-link text-gray-500 hover:text-indigo-600 px-3 py-2 font-medium border-b-2 border-transparent">Workstations</button>
      <button data-tab="equipment" class="tab-link text-gray-500 hover:text-indigo-600 px-3 py-2 font-medium border-b-2 border-transparent">Equipment</button>
      <!-- <button data-tab="options" class="tab-link text-gray-500 hover:text-indigo-600 px-3 py-2 font-medium border-b-2 border-transparent">‚ö° Quick Options</button> -->
    </nav>
  </div>

  <!-- Tab Contents -->
  <div id="tab-contents">

    <!-- Profile -->
    <div id="profile" class="tab-content">
      <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-xl font-bold text-indigo-800 mb-4">üéì Student Information</h3>
        <div class="grid grid-cols-2 gap-4 text-gray-700">
          <p><strong>Roll:</strong> {{ student.roll }}</p>
          <p><strong>Name:</strong> {{ student.name }}</p>
          <p><strong>Course:</strong> {{ student.course }}</p>
          <p><strong>Year:</strong> {{ student.year }}</p>
          <p><strong>Joining Year:</strong> {{ student.joining_year }}</p>
          <p><strong>Faculty:</strong> {{ student.faculty }}</p>
          <p><strong>Email:</strong> {{ student.email }}</p>
          <p><strong>Phone:</strong> {{ student.phone or "‚Äî" }}</p>
        </div>
      </div>
    </div>

    <!-- Space -->
    <div id="space" class="tab-content hidden">
      <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-xl font-bold text-indigo-800 mb-4">üè¢ Space Allocation</h3>
        {% if current_cubicle %}
          <p class="text-gray-700 mb-3">
            Current: <strong>{{ current_cubicle.room_lab.name }}</strong>,
            Cubicle <strong>{{ current_cubicle.number }}</strong>
          </p>
        {% else %}
          <p class="text-gray-500 mb-3">‚ùå No current space allocated</p>
        {% endif %}
        <a href="{{ url_for('space_allocation', roll=student.roll) }}"
           class="inline-block bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 mb-4">
          Manage Space
        </a>
       
      </div>
    </div>

    <!-- Workstations -->
    <div id="workstations" class="tab-content hidden">
      <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-xl font-bold text-indigo-800 mb-4">üíª Workstation Assignments</h3>
        <h4 class="font-semibold text-gray-800 mb-2">Current</h4>
        {% if workstation_active %}
           <table class="min-w-full border border-gray-300 text-center">
      <thead class="bg-gray-100">
              <tr class="bg-gray-100 text-center">
                <th class="px-4 py-2 border">Serial</th>
                <th class="px-4 py-2 border">Model</th>
                <th class="px-4 py-2 border">Issue Date</th>
                <th class="px-4 py-2 border">Required Till</th>
              </tr>
            </thead>
            <tbody>
              {% for ws in workstation_active %}
              <tr class="border-t">
                <td class="px-4 py-2 border">{{ ws.asset.serial }}</td>
                <td class="px-4 py-2 border">{{ ws.asset.manufacturer }} {{ ws.asset.model }}</td>
                <td class="px-4 py-2 border">{{ ws.issue_date }}</td>
                <td class="px-4 py-2 border">{{ ws.system_required_till }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="text-gray-500 mb-4">No active workstations</p>
        {% endif %}

    <div class="mt-8">
  <h3 class="text-xl font-semibold text-gray-800 mb-4">Workstation Assignment History</h3>
  <div class="overflow-x-auto bg-white shadow rounded-lg">
    <table class="min-w-full border border-gray-300 text-center">
  <thead class="bg-gray-100">
    <tr>
      <th class="px-4 py-2 border">Serial</th>
      <th class="px-4 py-2 border">Model</th>
      <th class="px-4 py-2 border">Issue Date</th>
      <th class="px-4 py-2 border">Required Till</th>
    </tr>
  </thead>
  <tbody>
    {% for ws in workstation_active %}
    <tr class="border-t">
      <td class="px-4 py-2 border text-center">{{ ws.asset.serial }}</td>
      <td class="px-4 py-2 border text-center">{{ ws.asset.manufacturer }} {{ ws.asset.model }}</td>
      <td class="px-4 py-2 border text-center">{{ ws.issue_date }}</td>
      <td class="px-4 py-2 border text-center">{{ ws.system_required_till }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

  </div>
</div>

        <a href="{{ url_for('assignment_new', roll=student.roll) }}"
           class="mt-4 inline-block bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
          Assign New Workstation
        </a>
      </div>
    </div>

    <!-- Equipment -->
    <div id="equipment" class="tab-content hidden">
      <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-xl font-bold text-indigo-800 mb-4">üñ•Ô∏è IT Equipment</h3>
        <h4 class="font-semibold text-gray-800 mb-2">Current</h4>
        {% if equipment_active %}
          <table class="min-w-full border border-gray-300 text-center">
  <thead class="bg-gray-100">
    <tr>
      <th class="px-4 py-2 border">Serial</th>
      <th class="px-4 py-2 border">Model</th>
      <th class="px-4 py-2 border">Issue Date</th>
      <th class="px-4 py-2 border">Expected Return</th>
      <th class="px-4 py-2 border">Actual Return</th>
    </tr>
  </thead>
  <tbody>
    {% for a in student.workstation_assignments %}
    <tr class="hover:bg-gray-50">
      <td class="px-4 py-2 border text-center">{{ a.asset.serial }}</td>
      <td class="px-4 py-2 border text-center">{{ a.asset.model }}</td>
      <td class="px-4 py-2 border text-center">{{ a.issue_date }}</td>
      <td class="px-4 py-2 border text-center">{{ a.system_required_till }}</td>
      <td class="px-4 py-2 border text-center">
        {% if a.end_date %}
          {{ a.end_date }}
        {% else %}
          <span class="text-red-600 font-semibold">Not Returned</span>
        {% endif %}
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="5" class="text-center text-gray-500 py-3">No workstation assignments found.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

        {% else %}
          <p class="text-gray-500 mb-4">No active equipment</p>
        {% endif %}

        <h4 class="font-semibold text-gray-800 mb-2">History</h4>
        {% if equipment_history %}
          <table class="table-auto w-full border text-gray-700">
            <thead>
              <tr class="bg-gray-100">
                <th class="p-2">Type</th>
                <th>Details</th>
                <th>Issue Date</th>
                <th>Return Date</th>
              </tr>
            </thead>
            <tbody>
              {% for eq in equipment_history %}
              <tr class="border-t">
                <td class="p-2">{{ eq.type }}</td>
                <td>{{ eq.details }}</td>
                <td>{{ eq.issue_date }}</td>
                <td>{{ eq.return_date or "Not Returned" }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="text-gray-500">No equipment history</p>
        {% endif %}
      </div>
    </div>

  

  </div>
  {% endif %}
</div>
<div>
<div class="mt-8 flex justify-center gap-6">
  <a href="/allotted_roll_check"
     class="inline-block bg-sky-600 hover:bg-sky-700 text-white px-6 py-2 rounded-lg shadow-md transition">
    ‚¨ÖÔ∏è Back to Search
  </a>
  <a href="/login_home"
     class="inline-block bg-sky-600 hover:bg-sky-700 text-white px-6 py-2 rounded-lg shadow-md transition">
    ‚¨ÖÔ∏è Back to Dashboard
  </a>
</div>
</div>
<!-- Tabs Script -->
<script>
  const tabLinks = document.querySelectorAll(".tab-link");
  const tabContents = document.querySelectorAll(".tab-content");

  tabLinks.forEach(link => {
    link.addEventListener("click", () => {
      const tab = link.dataset.tab;
      tabLinks.forEach(l => l.classList.remove("border-indigo-600", "text-indigo-600"));
      link.classList.add("border-indigo-600", "text-indigo-600");
      tabContents.forEach(c => c.classList.add("hidden"));
      document.getElementById(tab).classList.remove("hidden");
    });
  });
</script>
{% endblock %}
