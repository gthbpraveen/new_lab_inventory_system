{% extends "login_home.html" %}
{% block title %}Lab-wise Machine Allotment{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto bg-white p-6 rounded shadow">
  <div class="max-w-10xl mx-auto px-4 py-4">
    <header class="bg-pink-100 rounded-md shadow-sm p-4 text-center">
      <div class="flex flex-col items-center justify-center space-y-2">
        <h1 class="text-xl sm:text-2xl font-semibold text-blue-700">
          Lab Wise Machine Allotment List
        </h1>
      </div>
    </header>
  </div>

  {% if grouped_records %}
    {% for room, room_records in grouped_records.items() %}
      <div class="bg-white py-3 rounded text-center mb-1">
        <div class="bg-white px-4 py-3 rounded-md mb-4 text-center shadow">
          <h2 class="text-2xl font-bold text-blue-700 mb-1">
            Room: {{ room }}
          </h2>
          <div class="text-sm text-yellow-900">
            {% set stats = lab_stats.get(room) %}
            {% if stats %}
              <span><strong>Total Systems:</strong> {{ stats.total }}</span> |
              <span><strong>Allotted:</strong> {{ stats.used }}</span> |
              <span><strong>Available:</strong> {{ stats.available }}</span>
              {% if stats.staff_incharge %}
                | <span><strong>Staff In-charge:</strong> {{ stats.staff_incharge }}</span>
              {% endif %}
            {% else %}
              <span class="text-gray-500">No stats available for this room.</span>
            {% endif %}
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-300 text-sm">
            <thead class="bg-indigo-100">
              <tr>
                <th class="py-2 px-4 border-b text-left">#</th>
                <th class="py-2 px-4 border-b">Student Name</th>
                <th class="py-2 px-4 border-b">Roll</th>
                <th class="py-2 px-4 border-b">Course</th>
                <th class="py-2 px-4 border-b">Year</th>
                <th class="py-2 px-4 border-b">Faculty</th>
                <th class="py-2 px-4 border-b">Email</th>
                <th class="py-2 px-4 border-b">Phone</th>
                <th class="py-2 px-4 border-b">System ID</th>
                <th class="py-2 px-4 border-b">Serial</th>
                <th class="py-2 px-4 border-b">Manufacturer</th>
                <th class="py-2 px-4 border-b">Model</th>
                <th class="py-2 px-4 border-b">Indenter</th>
                <th class="py-2 px-4 border-b">Issue Date</th>
                <th class="py-2 px-4 border-b">Required Till</th>
                <th class="py-2 px-4 border-b">Remarks</th>
              </tr>
            </thead>
            <tbody>
              {% for r in room_records %}
              <tr class="hover:bg-gray-50">
                <td class="py-2 px-4 border-b">{{ loop.index }}</td>
                <td class="py-2 px-4 border-b">{{ r.name }}</td>
                <td class="py-2 px-4 border-b">{{ r.roll }}</td>
                <td class="py-2 px-4 border-b">{{ r.course }}</td>
                <td class="py-2 px-4 border-b">{{ r.year }}</td>
                <td class="py-2 px-4 border-b">{{ r.faculty }}</td>
                <td class="py-2 px-4 border-b">{{ r.email }}</td>
                <td class="py-2 px-4 border-b">{{ r.phone }}</td>
                <td class="py-2 px-4 border-b">{{ r.asset_id }}</td>
                <td class="py-2 px-4 border-b">{{ r.serial }}</td>
                <td class="py-2 px-4 border-b">{{ r.manufacturer }}</td>
                <td class="py-2 px-4 border-b">{{ r.model }}</td>
                <td class="py-2 px-4 border-b">{{ r.indenter }}</td>
                <td class="py-2 px-4 border-b">{{ r.issue_date }}</td>
                <td class="py-2 px-4 border-b">{{ r.system_required_till }}</td>
                <td class="py-2 px-4 border-b">{{ r.remarks or "-" }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p class="text-gray-600">No records found.</p>
  {% endif %}

  <div class="mt-6">
    <a href="/login_home" class="inline-block px-6 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">
      Back to Dashboard
    </a>
  </div>
</div>
{% endblock %}
